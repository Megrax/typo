<!DOCTYPE html>
<html lang="{{ or site.Language.LanguageCode site.Language.Lang }}"
  dir="{{ or site.Language.LanguageDirection `ltr` }}">

  <head>
    {{ partial "head.html" . }}
  </head>

  {{ $theme := "auto"}}

  {{ with .Param "theme" }}
  {{ $theme = .}}
  {{ end }}

  <body class="{{ $theme }}">

    <div class="content">
      <header>
        {{ partial "header.html" . }}
      </header>

      <main class="main">
        {{ block "main" . }}{{ end }}
      </main>
    </div>

    <footer>
      {{ partial "footer.html" . }}
    </footer>

  </body>

  <script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

<!-- image-group shortcode script -->
<script>
  const GAP_SIZE = 16;
  const MAIN_WIDTH = document.querySelector('main.main').clientWidth;
    const GAP_PERCENT = GAP_SIZE / MAIN_WIDTH * 100;

  const figures = [...document.querySelectorAll(".image-group-container figure")];
  const images = [...document.querySelectorAll(".image-group-container img")];
  const proms = images.map((img) => new Promise((resolve) =>
      img.onload = () => resolve([img.naturalWidth, img.naturalHeight])
  ))

  // Process images' widths and heights _after_ loaded:
  Promise.all(proms).then((data) => {
      const rawRatioList = [];
      const finalRatioList = [];
      data.forEach(([w, h]) => {
          rawRatioList.push(w / h);
      });
      const ratioSum = rawRatioList[0] + rawRatioList[1];
      rawRatioList.forEach((rawRatio) => {
          finalRatioList.push(Number(rawRatio / ratioSum * 100 - GAP_PERCENT / 2).toFixed(2) + '%');
      });
      figures[0].style.width = finalRatioList[0];
      figures[1].style.width = finalRatioList[1];
  })
</script>

</html>